@startuml モード切替状態遷移図

' モードの定義
state "対局モード" as PlayMode {
  state "通常対局" as NormalPlay
  state "最新手" as LatestMove
  state "閲覧中" as ViewMode
  
  [*] --> NormalPlay
  NormalPlay --> ViewMode : 過去の手に移動
  ViewMode --> NormalPlay : 最新手に移動
}

state "編集モード" as EditMode {
  state "駒配置中" as PlacingPieces
  state "駒削除中" as RemovingPieces
  state "持ち駒編集中" as EditingHand
  state "手番設定中" as SettingPlayer
  
  [*] --> PlacingPieces
  PlacingPieces --> RemovingPieces : 削除モード選択
  RemovingPieces --> PlacingPieces : 配置モード選択
  PlacingPieces --> EditingHand : 持ち駒編集
  EditingHand --> PlacingPieces : 盤面編集
  PlacingPieces --> SettingPlayer : 手番変更
  SettingPlayer --> PlacingPieces : 設定完了
}

state "検討モード" as StudyMode {
  state "手順確認中" as ReviewingMoves
  state "分岐作成中" as CreatingBranch
  state "コメント入力中" as InputtingComment
  
  [*] --> ReviewingMoves
  ReviewingMoves --> CreatingBranch : 新しい手順入力
  CreatingBranch --> ReviewingMoves : 分岐確定
  ReviewingMoves --> InputtingComment : コメント追加
  InputtingComment --> ReviewingMoves : コメント保存
}

' モード間の遷移
PlayMode --> EditMode : 編集開始\n(確認ダイアログ)
EditMode --> PlayMode : 編集完了\n(局面を初期状態として設定)

PlayMode --> StudyMode : 検討開始
StudyMode --> PlayMode : 検討終了\n(現在の局面から対局開始)

EditMode --> StudyMode : 編集完了\n(編集局面から検討開始)
StudyMode --> EditMode : 局面編集開始\n(現在の局面を編集)

' 各モードの説明注釈
note right of PlayMode
  - 手番制約あり
  - 合法手チェックあり
  - 最新手でのみ指し手可能
end note

note right of EditMode
  - 自由な駒配置
  - 持ち駒の増減可能
  - 手番の切り替え可能
  - アンドゥ/リドゥ可能
end note

note right of StudyMode
  - 任意の手順入力可能
  - 分岐作成可能
  - コメント追加可能
  - 手順の削除可能
end note

@enduml