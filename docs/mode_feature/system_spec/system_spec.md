# モード切替機能 システム仕様書

## 1. 概要
将棋GUIアプリケーションにおいて、以下の3つのモードを切り替えて使用できる機能を提供します。
1. 対局モード: 実際の対局を行う機能
2. 編集モード: 任意の局面を作成・編集する機能
3. 検討モード: 局面の再生・分岐検討・コメント追加機能

## 2. 機能要件

### 2.1 対局モード
- 通常の対局機能を提供
- 先手・後手が交互に指し手を入力
- 以下の操作が可能:
  - 駒の移動
  - 持ち駒の使用
  - 投了

### 2.2 編集モード
- 盤面を自由に編集可能（盤面と持ち駒の合計枚数は常に一定）
- 以下の操作が可能:
  - 駒の配置
  - 駒の成り/不成りの切り替え
  - 持ち駒の増減
  - 手番の切り替え
- 編集完了後、その局面から対局モードまたは検討モードへ移行可能

### 2.3 検討モード
- 棋譜の再生・分岐検討機能を提供
- 以下の操作が可能:
  - 任意の局面への移動
  - 新しい手順の追加（分岐の作成）
  - 手順の削除
  - コメントの追加
- 対局モードのルール制約は適用しない

## 3. UI仕様

### 3.1 モード切替UI
- 画面上部にモード切替タブまたはドロップダウンを配置
- 現在のモードを視覚的に明確に表示
- モード切替時は即時で切り替え、確認ダイアログは不要

### 3.2 モード別UI要素

#### 対局モード
- 基本的な将棋盤UI
- 先手の持ち駒表示エリア（常に表示）
- 後手の持ち駒表示エリア（常に表示）
- 手番表示
- 投了ボタン

#### 編集モード
- モード切替タブ
- 手番変更ボタン
- 手番表示
- 先手の持ち駒表示エリア
- 後手の持ち駒表示エリア
- 編集用将棋盤（駒操作は盤面上で直接行う）

#### 検討モード
- 棋譜表示パネル, 分岐表示/選択UI, コメント入力エリア, ナビゲーションコントロール

### 3.3 UIモックアップ (静的HTML)
以下のファイルにそれぞれのモード用モックアップを配置しています。ブラウザで開き、レイアウトイメージをご確認ください。
- `docs/mode_feature/adr/ui_ux_mockup.html`: 対局モード
- `docs/mode_feature/adr/ui_ux_edit_mockup.html`: 編集モード
- `docs/mode_feature/adr/ui_ux_analysis_mockup.html`: 検討モード

## 5. モード切替フロー
- モード切替時には、Gameオブジェクトの `mode` 属性を選択されたモードに更新するだけ
  - 例:`game.mode = GameMode.EDIT` や `game.mode = GameMode.ANALYSIS`
- その他の局面・手番・手順履歴などの状態はそのまま維持
- UI は更新後の `game.mode` を参照して表示を切り替え

## 6. エラー処理

### 6.1 モード切替時のエラー
- 不正な局面でのモード切替防止
- 未保存の変更がある場合の警告
- 編集モードでの無効な駒配置の検出

### 6.2 操作制限
- 各モードで許可されない操作の無効化
- 対応するエラーメッセージの表示

## 7. 注意事項
- UI/UXの大幅な変更は禁止
- 技術スタックのバージョンは変更しない
- 仕様変更時は各設計書を同時に更新 