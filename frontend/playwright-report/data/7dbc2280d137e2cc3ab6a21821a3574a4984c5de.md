# Test info

- Name: 編集モード >> 編集モードの基本UI要素が表示される
- Location: C:\Users\kinoko\shogi_gui\frontend\tests\edit-mode.spec.ts:25:3

# Error details

```
Error: Timed out 5000ms waiting for expect(locator).toBeVisible()

Locator: locator('.board-controls')
Expected: visible
Received: <element(s) not found>
Call log:
  - expect.toBeVisible with timeout 5000ms
  - waiting for locator('.board-controls')

    at C:\Users\kinoko\shogi_gui\frontend\tests\edit-mode.spec.ts:27:51
```

# Page snapshot

```yaml
- banner: 対局モード 編集モード 検討モード
- button "対局開始"
- button "入玉宣言"
- button "投了"
- text: "手数: 0 | 手番: 先手 香 桂 銀 金 玉 金 銀 桂 香 飛 角 歩 歩 歩 歩 歩 歩 歩 歩 歩 歩 歩 歩 歩 歩 歩 歩 歩 歩 角 飛 香 桂 銀 金 王 金 銀 桂 香"
- heading "棋譜" [level=3]
- button "|◀" [disabled]
- button "◀" [disabled]
- button "▶" [disabled]
- button "▶|" [disabled]
- text: 0. 開始局面
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 |
   3 | test.describe('編集モード', () => {
   4 |   test.beforeEach(async ({ page }) => {
   5 |     // アプリのトップページに移動
   6 |     await page.goto('/');
   7 |     
   8 |     // ページが読み込まれるまで待機
   9 |     await page.waitForSelector('#app');
   10 |     
   11 |     // 少し待ってからストアにアクセス
   12 |     await page.waitForTimeout(2000);
   13 |     
   14 |     // EditBoardコンポーネントまたはモード表示の要素を待機
   15 |     // 編集モードがデフォルトなのでそのまま進める
   16 |     try {
   17 |       await page.waitForSelector('.edit-board-container', { timeout: 5000 });
   18 |     } catch (e) {
   19 |       // EditBoardコンポーネントが見つからない場合、App.vueの構造を確認
   20 |       console.log('EditBoard not found, checking current state...');
   21 |       await page.screenshot({ path: 'debug-initial-state.png' });
   22 |     }
   23 |   });
   24 |
   25 |   test('編集モードの基本UI要素が表示される', async ({ page }) => {
   26 |     // 基本的なUI要素の存在確認
>  27 |     await expect(page.locator('.board-controls')).toBeVisible();
      |                                                   ^ Error: Timed out 5000ms waiting for expect(locator).toBeVisible()
   28 |     await expect(page.locator('.current-side')).toBeVisible();
   29 |     await expect(page.locator('.toggle-side-btn')).toBeVisible();
   30 |     await expect(page.locator('.save-btn')).toBeVisible();
   31 |     await expect(page.locator('.shogi-board')).toBeVisible();
   32 |     await expect(page.locator('.operation-guide')).toBeVisible();
   33 |   });
   34 |
   35 |   test('手番切り替えボタンが正常に動作する', async ({ page }) => {
   36 |     // 初期状態（先手）を確認
   37 |     await expect(page.locator('.current-side')).toContainText('現在: 先手');
   38 |     
   39 |     // 手番切り替えボタンをクリック
   40 |     await page.click('.toggle-side-btn');
   41 |     
   42 |     // 後手に変わることを確認
   43 |     await expect(page.locator('.current-side')).toContainText('現在: 後手');
   44 |     
   45 |     // もう一度クリックして先手に戻ることを確認
   46 |     await page.click('.toggle-side-btn');
   47 |     await expect(page.locator('.current-side')).toContainText('現在: 先手');
   48 |   });
   49 |
   50 |   test('盤上の駒をクリックして状態変更ができる', async ({ page }) => {
   51 |     // 先手の歩（P）を見つけてクリック
   52 |     const pawnCell = page.locator('.shogi-cell').filter({
   53 |       has: page.locator('.piece-shape.b[data-piece="P"]')
   54 |     }).first();
   55 |     
   56 |     // 駒が存在することを確認
   57 |     await expect(pawnCell).toBeVisible();
   58 |     
   59 |     // 1回クリック：成り不成反転（P → +P）
   60 |     await pawnCell.click();
   61 |     await expect(pawnCell.locator('[data-piece="+P"]')).toBeVisible();
   62 |     
   63 |     // 2回目クリック：向き反転（+P → +p）
   64 |     await pawnCell.click();
   65 |     await expect(pawnCell.locator('[data-piece="+p"]')).toBeVisible();
   66 |     
   67 |     // 3回目クリック：成り不成反転（+p → p）
   68 |     await pawnCell.click();
   69 |     await expect(pawnCell.locator('[data-piece="p"]')).toBeVisible();
   70 |     
   71 |     // 4回目クリック：向き反転（p → P）
   72 |     await pawnCell.click();
   73 |     await expect(pawnCell.locator('[data-piece="P"]')).toBeVisible();
   74 |   });
   75 |
   76 |   test('右クリックで駒を持ち駒に移動できる', async ({ page }) => {
   77 |     // 盤上の駒を右クリック
   78 |     const pieceCell = page.locator('.shogi-cell').filter({
   79 |       has: page.locator('.piece-shape[data-piece]')
   80 |     }).first();
   81 |     
   82 |     // 駒が存在することを確認
   83 |     await expect(pieceCell).toBeVisible();
   84 |     
   85 |     // 右クリックで駒を持ち駒に移動
   86 |     await pieceCell.click({ button: 'right' });
   87 |     
   88 |     // 駒が盤上から消えることを確認
   89 |     await expect(pieceCell.locator('.piece-shape')).not.toBeVisible();
   90 |     
   91 |     // 持ち駒エリアに駒が追加されることを確認（少し待機）
   92 |     await page.waitForTimeout(500);
   93 |     const handPieces = page.locator('.pieces-in-hand .piece-container');
   94 |     await expect(handPieces.first()).toBeVisible();
   95 |   });
   96 |
   97 |   test('持ち駒から盤上に駒を配置できる', async ({ page }) => {
   98 |     // まず右クリックで駒を持ち駒に移動
   99 |     const pieceCell = page.locator('.shogi-cell').filter({
  100 |       has: page.locator('.piece-shape[data-piece]')
  101 |     }).first();
  102 |     
  103 |     await pieceCell.click({ button: 'right' });
  104 |     
  105 |     // 持ち駒をクリックして選択
  106 |     const handPiece = page.locator('.pieces-in-hand .piece-container').first();
  107 |     await expect(handPiece).toBeVisible();
  108 |     await handPiece.click();
  109 |     
  110 |     // 選択状態になることを確認
  111 |     await expect(handPiece.locator('.piece-shape.selected')).toBeVisible();
  112 |     
  113 |     // 空のマスをクリックして配置
  114 |     const emptyCell = page.locator('.shogi-cell').filter({
  115 |       hasNot: page.locator('.piece-shape')
  116 |     }).first();
  117 |     
  118 |     await emptyCell.click();
  119 |     
  120 |     // 駒が配置されることを確認
  121 |     await expect(emptyCell.locator('.piece-shape')).toBeVisible();
  122 |     
  123 |     // 持ち駒から駒が減ることを確認（選択状態が解除される）
  124 |     await expect(handPiece.locator('.piece-shape.selected')).not.toBeVisible();
  125 |   });
  126 |
  127 |   test('操作説明が表示される', async ({ page }) => {
```