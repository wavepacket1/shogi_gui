# Test info

- Name: 持ち駒テスト >> 先手の手番で右クリックした駒は先手の駒台に追加される
- Location: C:\Users\kinoko\shogi_gui\frontend\tests\hand-piece-test.spec.ts:13:3

# Error details

```
Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:8080/
Call log:
  - navigating to "http://localhost:8080/", waiting until "load"

    at C:\Users\kinoko\shogi_gui\frontend\tests\hand-piece-test.spec.ts:5:16
```

# Page snapshot

```yaml
- heading "このサイトにアクセスできません" [level=1]
- paragraph:
  - strong: localhost
  - text: で接続が拒否されました。
- paragraph: 次をお試しください
- list:
  - listitem: 接続を確認する
  - listitem:
    - link "プロキシとファイアウォールを確認する":
      - /url: "#buttons"
- text: ERR_CONNECTION_REFUSED
- button "再読み込み"
- button "詳細"
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 |
   3 | test.describe('持ち駒テスト', () => {
   4 |   test.beforeEach(async ({ page }) => {
>  5 |     await page.goto('http://localhost:8080');
     |                ^ Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:8080/
   6 |     
   7 |     // 編集モードに切り替え
   8 |     await page.click('.tab:has-text("編集モード")');
   9 |     await page.waitForSelector('.edit-board-container', { timeout: 10000 });
   10 |     await page.waitForTimeout(2000);
   11 |   });
   12 |
   13 |   test('先手の手番で右クリックした駒は先手の駒台に追加される', async ({ page }) => {
   14 |     // 先手の手番であることを確認
   15 |     await expect(page.locator('.current-side')).toContainText('先手');
   16 |     
   17 |     // 初期の先手持ち駒数を取得
   18 |     const initialBlackPieces = await page.locator('.pieces-in-hand').last().locator('.piece-container').count();
   19 |     console.log('初期の先手持ち駒数:', initialBlackPieces);
   20 |     
   21 |     // 盤上の駒を右クリック
   22 |     const pieceCell = page.locator('.shogi-cell').filter({
   23 |       has: page.locator('.piece-shape[data-piece]')
   24 |     }).first();
   25 |     
   26 |     const pieceType = await pieceCell.locator('.piece-shape').getAttribute('data-piece');
   27 |     console.log('右クリックする駒:', pieceType);
   28 |     
   29 |     await pieceCell.click({ button: 'right' });
   30 |     await page.waitForTimeout(1500);
   31 |     
   32 |     // 右クリック後の先手持ち駒数を取得
   33 |     const afterBlackPieces = await page.locator('.pieces-in-hand').last().locator('.piece-container').count();
   34 |     console.log('右クリック後の先手持ち駒数:', afterBlackPieces);
   35 |     
   36 |     // 先手の駒台に駒が追加されたことを確認
   37 |     expect(afterBlackPieces).toBeGreaterThan(initialBlackPieces);
   38 |   });
   39 |
   40 |   test('後手の手番で右クリックした駒は後手の駒台に追加される', async ({ page }) => {
   41 |     // 後手の手番に切り替え
   42 |     await page.click('.toggle-side-btn');
   43 |     await expect(page.locator('.current-side')).toContainText('後手');
   44 |     
   45 |     // 初期の後手持ち駒数を取得
   46 |     const initialWhitePieces = await page.locator('.pieces-in-hand').first().locator('.piece-container').count();
   47 |     console.log('初期の後手持ち駒数:', initialWhitePieces);
   48 |     
   49 |     // 盤上の駒を右クリック
   50 |     const pieceCell = page.locator('.shogi-cell').filter({
   51 |       has: page.locator('.piece-shape[data-piece]')
   52 |     }).first();
   53 |     
   54 |     const pieceType = await pieceCell.locator('.piece-shape').getAttribute('data-piece');
   55 |     console.log('右クリックする駒:', pieceType);
   56 |     
   57 |     await pieceCell.click({ button: 'right' });
   58 |     await page.waitForTimeout(1500);
   59 |     
   60 |     // 右クリック後の後手持ち駒数を取得
   61 |     const afterWhitePieces = await page.locator('.pieces-in-hand').first().locator('.piece-container').count();
   62 |     console.log('右クリック後の後手持ち駒数:', afterWhitePieces);
   63 |     
   64 |     // 後手の駒台に駒が追加されたことを確認
   65 |     expect(afterWhitePieces).toBeGreaterThan(initialWhitePieces);
   66 |   });
   67 |
   68 |   test('手番を切り替えながら複数の駒を右クリックして、それぞれ適切な駒台に追加される', async ({ page }) => {
   69 |     // 先手の手番から開始
   70 |     await expect(page.locator('.current-side')).toContainText('先手');
   71 |     
   72 |     // 初期の持ち駒数を記録
   73 |     const initialBlackPieces = await page.locator('.pieces-in-hand').last().locator('.piece-container').count();
   74 |     const initialWhitePieces = await page.locator('.pieces-in-hand').first().locator('.piece-container').count();
   75 |     
   76 |     console.log('初期状態 - 先手持ち駒:', initialBlackPieces, '後手持ち駒:', initialWhitePieces);
   77 |     
   78 |     // 1. 先手の手番で駒を右クリック
   79 |     const firstPiece = page.locator('.shogi-cell').filter({
   80 |       has: page.locator('.piece-shape[data-piece]')
   81 |     }).first();
   82 |     
   83 |     await firstPiece.click({ button: 'right' });
   84 |     await page.waitForTimeout(1000);
   85 |     
   86 |     // 先手の駒台に追加されたことを確認
   87 |     const blackAfterFirst = await page.locator('.pieces-in-hand').last().locator('.piece-container').count();
   88 |     expect(blackAfterFirst).toBeGreaterThan(initialBlackPieces);
   89 |     
   90 |     // 2. 後手の手番に切り替え
   91 |     await page.click('.toggle-side-btn');
   92 |     await expect(page.locator('.current-side')).toContainText('後手');
   93 |     
   94 |     // 3. 後手の手番で別の駒を右クリック
   95 |     const secondPiece = page.locator('.shogi-cell').filter({
   96 |       has: page.locator('.piece-shape[data-piece]')
   97 |     }).first();
   98 |     
   99 |     await secondPiece.click({ button: 'right' });
  100 |     await page.waitForTimeout(1000);
  101 |     
  102 |     // 後手の駒台に追加されたことを確認
  103 |     const whiteAfterSecond = await page.locator('.pieces-in-hand').first().locator('.piece-container').count();
  104 |     expect(whiteAfterSecond).toBeGreaterThan(initialWhitePieces);
  105 |     
```